<!DOCTYPE html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>Processing.js LiveTwitter Demo</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript" ></script>
  <script src="../../processing.js" type="text/javascript"></script>
	<script src="livetwitter.js" type="text/javascript"></script>
</head>
<body>
  <script id="sketch" type="application/processing">
    // Dynamic list of Tweet objects
    HashMap tweets;

    // A class representing a Tweet
    class Tweet {
      String id;
      String profileName;
      PImage profileImage;
      String text;
      Date time;
      int randomPosX;
      int randomPosY;

      Tweet(String aId,
            String aProfileName,
            String aProfileImageURL,
            String aText,
            Date aTime) {
        id = aId;
        profileName = aProfileName;
        profileImage = requestImage(aProfileImageURL);
        text = aText;
        time = aTime;

        // Draw profile images to the same place each frame
        randomPosX = random(0, width);
        randomPosY = random(0, height);
      }
    }

    void setup() {
      size(1024, 1024);
      tweets = new HashMap();
    }

    void draw() {
      background(255);

      if (tweets.size() == 0) {
        return;
      }

      Tweet tweet;
      Iterator it = tweets.entrySet().iterator();
      object elem;

      while (it.hasNext()) {
        elem = it.next();
        tweet = (Tweet)elem.getValue();
        image(tweet.profileImage, tweet.randomPosX, tweet.randomPosY);
      }
    }

    // Called from external JS, passes new Tweet object
    void addTweet(Tweet tweet) {
      // Only store each tweet once (twitter sends them over and over)
      if (!tweets.containsKey(tweet.id)) {
        tweets.put(tweet.id, tweet);
      }
    }

    // Called from external JS, removes count tweets.
    void removeTweets(count) {
      while(count-- >= 0) {
        tweets.remove(tweets.size() - 1);
      }
    }

    void clearTweets() {
      background(255);
      tweets.clear();
    }
  </script>

  <div>
    <button onclick="twitter.start();">Start</button>
    <button onclick="twitter.stop();">Stop</button>
    <button onclick="twitter.clear();">Clear</button>
  </div>

  <canvas id="tweets"></canvas>

	<script type="text/javascript">
    var p = new Processing("tweets", document.getElementById("sketch").text);
//		$('#twitterSearch').liveTwitter('chicago', {limit: 10, rate: 5000, rpp: 10, geocode: '41.7897563,-87.5997711,1km'});
	  liveTwitter('toronto', {limit: 50, rate: 5000, rpp: 50}, p);

	</script>
</body>
</html>
